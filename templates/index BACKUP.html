<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>TierList Maker</title>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css"
    />
    <link rel="stylesheet" href="/static/style.css" />
    <script type="module" src="/static/main.js"></script>
  </head>
  <body>
    <h1>TierList Maker</h1>

    <div class="tiers container"></div>

    <!--- <div class="cards container"></div> -->

    <div class="scroll-container"></div>

    <dialog class="settings-modal">
      <section>
        <div class="colors"></div>

        <textarea class="tier-label" placeholder="Tier label"></textarea>

        <button id="delete">Delete Row</button>
        <button id="clear">Clear Row</button>
        <button id="prepend">Add a Row Above</button>
        <button id="append">Add a Row Below</button>
      </section>
    </dialog>
    <h1>Game Search</h1>
    <form id="inputForm">
        <label for="input_data">Enter some data:</label>
        <input type="text" id="input_data" name="input_data" required>
        <button type="submit">Submit</button>
    </form>
    <p id="response"></p>
    <div id="imageContainer"></div>
  </body>
  <body>
    <script>
        document.getElementById('inputForm').addEventListener('submit', function(event) {
            event.preventDefault(); // Prevent the form from submitting normally

            // Get the form data
            const formData = new FormData(this);

            // Send a POST request to the /submit endpoint
            fetch('/submit', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                // Display the response from the server
                document.getElementById('response').innerText = data.response;
            
                // Clear any existing images in the container
                const imageContainer = document.querySelector('.scroll-container');
                imageContainer.innerHTML = '';

                // Check if a list of image URLs was provided in the response
                if (data.boxarts) {
                    data.boxarts.forEach(url => {
                        var imgElement = document.createElement('img');
                        imgElement.src = url;
                        imgElement.alt = 'Dynamic Image';
                        imgElement.draggable = true;
                        imgElement.style.margin = '5px'; // Optional styling for spacing
                        imageContainer.appendChild(imgElement); // Append the image to the container
                        makeImagesDraggable();
                        //console.log(typeof imgElement);
                    });
                }
              })
            .catch(error => console.error('Error:', error));

            const makeImagesDraggable = () => {
              const images = document.querySelectorAll(".scroll-container img");
              images.forEach((img) => {
                img.draggable = true;

                img.addEventListener("dragstart", (event) => {
                  img.classList.add("dragging");
                  event.dataTransfer.setData('text/plain', ''); // Required for some browsers
                });

                img.addEventListener("dragend", () => {
                  img.classList.remove("dragging");
                });
              });
            };
        });
    </script>
  </body>
</html>
